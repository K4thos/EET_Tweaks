BACKUP ~EET_Tweaks/backup~
AUTHOR ~K4thos (swit)~
VERSION ~1.7~
README ~EET_Tweaks/lang/%LANGUAGE%/readme-EET_Tweaks.html~ ~EET_Tweaks/readme-EET_Tweaks.html~
ASK_EVERY_COMPONENT

ALWAYS
	INCLUDE ~EET_Tweaks/lib/always.tph~
END

LANGUAGE ~English~
	~en_US~
	~EET_Tweaks/lang/en_US/prompts.tra~
	~EET_Tweaks/lang/en_US/setup.tra~
LANGUAGE ~Polski (Polish)~
	~pl_PL~
	~EET_Tweaks/lang/pl_PL/prompts.tra~
	~EET_Tweaks/lang/pl_PL/setup.tra~
LANGUAGE ~Deutsch (German)~
	~de_DE~
	~EET_Tweaks/lang/de_DE/prompts.tra~
	~EET_Tweaks/lang/de_DE/setup.tra~

/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////                                                  \\\\\
///// Consistent NPCs                                  \\\\\
/////                                                  \\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\

/////                                                  \\\\\
///// Edwin appearance                                 \\\\\
/////                                                  \\\\\

BEGIN @900101 /*BG1*/
DESIGNATED 1000
SUBCOMPONENT @900100 /*Edwin appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~EDWIN~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN EDWIN EDWIN2 EDWIN4 EDWIN6 EDWIN7_ E35 EDWIN7 EDWIN9 EDWIN11 EDWIN12 EDWIN13 EDWIN15 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900102 /*BG2*/
DESIGNATED 1001
SUBCOMPONENT @900100 /*Edwin appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~EDWIN7~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN EDWIN EDWIN2 EDWIN4 EDWIN6 EDWIN7_ E35 EDWIN7 EDWIN9 EDWIN11 EDWIN12 EDWIN13 EDWIN15 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

/////                                                  \\\\\
///// Imoen appearance                                 \\\\\
/////                                                  \\\\\

BEGIN @900201 /*BG1*/
DESIGNATED 1010
SUBCOMPONENT @900200 /*Imoen appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~IMOEN1~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN IMOEN IMOEN1 IMOEN2 IMOEN4 IMOEN6_ BDIMOEN BDIMDEAD BDIMOEDO BDSHIMOE TTIMOEN IMOEN6 IMOEN10 IMOEN15 IMOEN211 IMOEN213 IMOENDRM CSIMOEN CUIMOEN CUIMOEN2 CUIMOEN3 DPIMO01 DREAM1 DRIM01 DRIM02 PPDRIMO PPDRIMOV PPIMOEN OHB1IMOE BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900202 /*BG2*/
DESIGNATED 1011
SUBCOMPONENT @900200 /*Imoen appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~IMOEN6~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN IMOEN IMOEN1 IMOEN2 IMOEN4 IMOEN6_ BDIMOEN BDIMDEAD BDIMOEDO BDSHIMOE TTIMOEN IMOEN6 IMOEN10 IMOEN15 IMOEN211 IMOEN213 IMOENDRM CSIMOEN CUIMOEN CUIMOEN2 CUIMOEN3 DPIMO01 DREAM1 DRIM01 DRIM02 PPDRIMO PPDRIMOV PPIMOEN OHB1IMOE BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900203 /*SoD*/
DESIGNATED 1012
SUBCOMPONENT @900200 /*Imoen appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~BDIMOEN~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN IMOEN IMOEN1 IMOEN2 IMOEN4 IMOEN6_ BDIMOEN BDIMDEAD BDIMOEDO BDSHIMOE TTIMOEN IMOEN6 IMOEN10 IMOEN15 IMOEN211 IMOEN213 IMOENDRM CSIMOEN CUIMOEN CUIMOEN2 CUIMOEN3 DPIMO01 DREAM1 DRIM01 DRIM02 PPDRIMO PPDRIMOV PPIMOEN OHB1IMOE BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

/////                                                  \\\\\
///// Jaheira appearance                               \\\\\
/////                                                  \\\\\

BEGIN @900301 /*BG1*/
DESIGNATED 1020
SUBCOMPONENT @900300 /*Jaheira appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~JAHEIR~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN JAHEIR JAHEIR2 JAHEIR4 JAHEIR6 JAHEIR7_ E36 TTJAHIER JAHEIR7 JAHEIR8 JAHEIR11 JAHEIR12 JAHEI12B JAHEI14 JAHEIRD IDIOT01 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900302 /*BG2*/
DESIGNATED 1021
SUBCOMPONENT @900300 /*Jaheira appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~JAHEIR7~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN JAHEIR JAHEIR2 JAHEIR4 JAHEIR6 JAHEIR7_ E36 TTJAHIER JAHEIR7 JAHEIR8 JAHEIR11 JAHEIR12 JAHEI12B JAHEI14 JAHEIRD IDIOT01 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

/////                                                  \\\\\
///// Minsc appearance                                 \\\\\
/////                                                  \\\\\

BEGIN @900401 /*BG1*/
DESIGNATED 1030
SUBCOMPONENT @900400 /*Minsc appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~MINSC~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN MINSC MINSC2 MINSC4 MINSC6 MINSC7_ E32 TTMINSC MINSC7 MINSC8 MINSC9 MINSC10 MINSC12 MINSC14 OHB1MINSC BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900402 /*BG2*/
DESIGNATED 1031
SUBCOMPONENT @900400 /*Minsc appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~MINSC7~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN MINSC MINSC2 MINSC4 MINSC6 MINSC7_ E32 TTMINSC MINSC7 MINSC8 MINSC9 MINSC10 MINSC12 MINSC14 OHB1MINSC BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

/////                                                  \\\\\
///// Viconia appearance                               \\\\\
/////                                                  \\\\\

BEGIN @900501 /*BG1*/
DESIGNATED 1040
SUBCOMPONENT @900500 /*Viconia appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~VICONI~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN VICONI VICONI4 VICONI6_ VICONI7 VICONI6 VICONI8 VICONI9 VICONI11 VICONI13 VICONI16 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900502 /*BG2*/
DESIGNATED 1041
SUBCOMPONENT @900500 /*Viconia appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~VICONI6~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN VICONI VICONI4 VICONI6_ VICONI7 VICONI6 VICONI8 VICONI9 VICONI11 VICONI13 VICONI16 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

BEGIN @900503 /*SoD*/
DESIGNATED 1042
SUBCOMPONENT @900500 /*Viconia appearance*/
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SPRINT file ~VICONI7~

ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN VICONI VICONI4 VICONI6_ VICONI7 VICONI6 VICONI8 VICONI9 VICONI11 VICONI13 VICONI16 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

/////                                                  \\\\\
///// Cameo NPCs appearance                            \\\\\
/////                                                  \\\\\

BEGIN @900600 /*Cameo NPCs appearance*/
DESIGNATED 1050
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

//Dorn
OUTER_SPRINT file ~DORN~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN DORN DORN2 DORN4 DORN6 DORN7 DORN8 DORN9 DORN10 DORN12 DORN14 OHB2DORN BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Neera
OUTER_SPRINT file ~NEERA~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN NEERA NEERA2 NEERA4 NEERA6 NEERA7 NEERA8 NEERA10 NEERA11 NEERA12 NEERA13 NEERA15 OHB1NEER BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Rasaad
OUTER_SPRINT file ~RASAAD~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN RASAAD RASAAD2 RASAAD4 RASAAD6 RASAAD7 RASAAD8 RASAAD9 RASAAD10 RASAAD11 RASAAD12 RASAAD13 OHB1RASD BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Baeloth
OUTER_SPRINT file ~BAELOTH~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN BAELOT7 OHB2BLTH OHBBAEL BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Coran
OUTER_SPRINT file ~CORAN~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN BDCORAN C6CORAN BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Dynaheir
OUTER_SPRINT file ~DYNAHE~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN DYNAHE7 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Faldorn
OUTER_SPRINT file ~FALDOR~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN CEFALD01 CEFALD02 CEFALD04 CEFALDOR BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Garrick
OUTER_SPRINT file ~GARRIC~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN BDGARRIC GARRICK BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Khalid
OUTER_SPRINT file ~KHALID~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN KHALID7 KHALIDD BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Najim
OUTER_SPRINT file ~BPNAJIM~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN OHBNAJIM BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Safana
OUTER_SPRINT file ~SAFANA~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN SAFANA7 C6SAFA BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Skie
OUTER_SPRINT file ~SKIE~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN BDSKIE BDSKIED BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Tiax
OUTER_SPRINT file ~TIAX~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN BDTIAX PPTIAX PPTIAX2 BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Quayle
OUTER_SPRINT file ~QUAYLE_~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN QUAYLE BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

//Xzar
OUTER_SPRINT file ~XZAR_~
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.CRE~) BEGIN
	COPY_EXISTING - ~%file%.CRE~ ~override~
		LPM EET_READ_APPEARANCE
	BUT_ONLY
	ACTION_FOR_EACH file IN LYROS XZAR BEGIN
		LAM EET_WRITE_APPEARANCE
	END
END

/////                                                  \\\\\
///// NPCs voices                                      \\\\\
/////                                                  \\\\\

BEGIN @900700 /*NPC voices*/
DESIGNATED 1060
GROUP @900000 /*Consistent NPCs*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/
REQUIRE_PREDICATE ("%LANGUAGE%" STRING_EQUAL_CASE ~pl_PL~) @990001 /*This component is not available for your language*/

LOAD_TRA ~EET_Tweaks/lang/%LANGUAGE%/voices.tra~

INCLUDE ~EET_Tweaks/lib/voices_%LANGUAGE%.tph~

/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////                                                  \\\\\
///// XP adjustments                                   \\\\\
/////                                                  \\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\

/////                                                  \\\\\
///// Total XP CAP                                     \\\\\
/////                                                  \\\\\

BEGIN @910101 /*2,950,000*/
DESIGNATED 2000
SUBCOMPONENT @910100 /*Total XP CAP*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~bg1 totsc soa tob iwd how totlm iwd2 tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/

OUTER_SET value = 2950000

ACTION_FOR_EACH file IN STARTARE STARTBP BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2DA~ BEGIN
		ACTION_DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~STARTARE~ => ~~ END
	END
END
ACTION_IF FILE_EXISTS_IN_GAME ~XPCAP.2DA~ BEGIN
	ACTION_DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~XPCAP~ => ~~ END
END
ACTION_IF FILE_EXISTS_IN_GAME ~campaign.2da~ BEGIN
	COPY_EXISTING - ~campaign.2da~ ~.../campaign.2da~
		COUNT_2DA_ROWS 32 "cntrow"
		FOR (cnt = 0; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			READ_2DA_ENTRY cnt 13 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~%file%~ => ~~ END
			END
			READ_2DA_ENTRY cnt 18 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~%file%~ => ~~ END
			END
		END
END

ACTION_PHP_EACH STARTARE_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		PRETTY_PRINT_2DA
	BUT_ONLY
END

ACTION_PHP_EACH XPCAP_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		COUNT_2DA_ROWS 2 "cntrow"
		FOR (cnt = 1; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			SET_2DA_ENTRY cnt 1 2 "%value%"
		END
		PRETTY_PRINT_2DA
	BUT_ONLY
END

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910102 /*8,000,000*/
DESIGNATED 2001
SUBCOMPONENT @910100 /*Total XP CAP*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~bg1 totsc soa tob iwd how totlm iwd2 tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/

OUTER_SET value = 8000000

ACTION_FOR_EACH file IN STARTARE STARTBP BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2DA~ BEGIN
		ACTION_DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~STARTARE~ => ~~ END
	END
END
ACTION_IF FILE_EXISTS_IN_GAME ~XPCAP.2DA~ BEGIN
	ACTION_DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~XPCAP~ => ~~ END
END
ACTION_IF FILE_EXISTS_IN_GAME ~campaign.2da~ BEGIN
	COPY_EXISTING - ~campaign.2da~ ~.../campaign.2da~
		COUNT_2DA_ROWS 32 "cntrow"
		FOR (cnt = 0; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			READ_2DA_ENTRY cnt 13 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~%file%~ => ~~ END
			END
			READ_2DA_ENTRY cnt 18 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~%file%~ => ~~ END
			END
		END
END

ACTION_PHP_EACH STARTARE_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		PRETTY_PRINT_2DA
	BUT_ONLY
END

ACTION_PHP_EACH XPCAP_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		COUNT_2DA_ROWS 2 "cntrow"
		FOR (cnt = 1; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			SET_2DA_ENTRY cnt 1 2 "%value%"
		END
		PRETTY_PRINT_2DA
	BUT_ONLY
END

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910103 /*Disabled*/
DESIGNATED 2002
SUBCOMPONENT @910100 /*Total XP CAP*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~bg1 totsc soa tob iwd how totlm iwd2 tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/

OUTER_SET value = "-1"

ACTION_FOR_EACH file IN STARTARE STARTBP BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2DA~ BEGIN
		ACTION_DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~STARTARE~ => ~~ END
	END
END
ACTION_IF FILE_EXISTS_IN_GAME ~XPCAP.2DA~ BEGIN
	ACTION_DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~XPCAP~ => ~~ END
END
ACTION_IF FILE_EXISTS_IN_GAME ~campaign.2da~ BEGIN
	COPY_EXISTING - ~campaign.2da~ ~.../campaign.2da~
		COUNT_2DA_ROWS 32 "cntrow"
		FOR (cnt = 0; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			READ_2DA_ENTRY cnt 13 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~%file%~ => ~~ END
			END
			READ_2DA_ENTRY cnt 18 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~%file%~ => ~~ END
			END
		END
END

ACTION_PHP_EACH STARTARE_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		PRETTY_PRINT_2DA
	BUT_ONLY
END

ACTION_PHP_EACH XPCAP_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		COUNT_2DA_ROWS 2 "cntrow"
		FOR (cnt = 1; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			SET_2DA_ENTRY cnt 1 2 "%value%"
		END
		PRETTY_PRINT_2DA
	BUT_ONLY
END

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910104 /*Custom value*/
DESIGNATED 2003
SUBCOMPONENT @910100 /*Total XP CAP*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~bg1 totsc soa tob iwd how totlm iwd2 tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~bg2_tweaks/setup-bg2_tweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2090 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2091 @990002 /*Similar tweak already installed*/
//FORBID_COMPONENT ~cdtweaks/setup-cdtweaks.tp2~ 2092 @990002 /*Similar tweak already installed*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPCapTotal) OR (NOT IS_AN_INT XPCapTotal) OR (XPCapTotal < 1) BEGIN
	PRINT @980000 /*Type in the integer value for XP CAP*/
	ACTION_READLN XPCapTotal
END

OUTER_SET value = XPCapTotal

ACTION_FOR_EACH file IN STARTARE STARTBP BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2DA~ BEGIN
		ACTION_DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~STARTARE~ => ~~ END
	END
END
ACTION_IF FILE_EXISTS_IN_GAME ~XPCAP.2DA~ BEGIN
	ACTION_DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~XPCAP~ => ~~ END
END
ACTION_IF FILE_EXISTS_IN_GAME ~campaign.2da~ BEGIN
	COPY_EXISTING - ~campaign.2da~ ~.../campaign.2da~
		COUNT_2DA_ROWS 32 "cntrow"
		FOR (cnt = 0; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			READ_2DA_ENTRY cnt 13 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY STARTARE_list BEGIN ~%file%~ => ~~ END
			END
			READ_2DA_ENTRY cnt 18 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.2DA~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY XPCAP_list BEGIN ~%file%~ => ~~ END
			END
		END
END

ACTION_PHP_EACH STARTARE_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
		PRETTY_PRINT_2DA
	BUT_ONLY
END

ACTION_PHP_EACH XPCAP_list AS file => dummy BEGIN
	COPY_EXISTING ~%file%.2da~ ~override~
		COUNT_2DA_ROWS 2 "cntrow"
		FOR (cnt = 1; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			SET_2DA_ENTRY cnt 1 2 "%value%"
		END
		PRETTY_PRINT_2DA
	BUT_ONLY
END

/////                                                  \\\\\
///// Additional XP CAP for BG1                        \\\\\
/////                                                  \\\\\

BEGIN @910201 /* 89,000*/
DESIGNATED 2010
SUBCOMPONENT @910200 /*Additional XP CAP for BG1*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 89000

COPY_EXISTING ~BGSTARTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910202 /*161,000*/
DESIGNATED 2011
SUBCOMPONENT @910200 /*Additional XP CAP for BG1*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 161000

COPY_EXISTING ~BGSTARTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910203 /*500,000*/
DESIGNATED 2012
SUBCOMPONENT @910200 /*Additional XP CAP for BG1*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 500000

COPY_EXISTING ~BGSTARTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910204 /*Custom value*/
DESIGNATED 2013
SUBCOMPONENT @910200 /*Additional XP CAP for BG1*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPCapBG1) OR (NOT IS_AN_INT XPCapBG1) OR (XPCapBG1 < 1) BEGIN
	PRINT @980000 /*Type in the integer value for XP CAP*/
	ACTION_READLN XPCapBG1
END

OUTER_SET value = XPCapBG1

COPY_EXISTING ~BGSTARTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

/////                                                  \\\\\
///// Additional XP CAP for SoD                        \\\\\
/////                                                  \\\\\

BEGIN @910301 /* 89,000*/
DESIGNATED 2020
SUBCOMPONENT @910300 /*Additional XP CAP for SoD*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 89000

COPY_EXISTING ~SODSTRTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910302 /*161,000*/
DESIGNATED 2021
SUBCOMPONENT @910300 /*Additional XP CAP for SoD*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 161000

COPY_EXISTING ~SODSTRTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910303 /*500,000*/
DESIGNATED 2022
SUBCOMPONENT @910300 /*Additional XP CAP for SoD*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 500000

COPY_EXISTING ~SODSTRTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910304 /*Custom value*/
DESIGNATED 2023
SUBCOMPONENT @910300 /*Additional XP CAP for SoD*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPCapSoD) OR (NOT IS_AN_INT XPCapSoD) OR (XPCapSoD < 1) BEGIN
	PRINT @980000 /*Type in the integer value for XP CAP*/
	ACTION_READLN XPCapSoD
END

OUTER_SET value = XPCapSoD

COPY_EXISTING ~SODSTRTA.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

/////                                                  \\\\\
///// Additional XP CAP for SoA                        \\\\\
/////                                                  \\\\\

BEGIN @910401 /*2,500,000*/
DESIGNATED 2030
SUBCOMPONENT @910400 /*Additional XP CAP for SoA*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 2500000

COPY_EXISTING ~STARTARE.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910402 /*2,950,000*/
DESIGNATED 2031
SUBCOMPONENT @910400 /*Additional XP CAP for SoA*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 2950000

COPY_EXISTING ~STARTARE.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910403 /*8,000,000*/
DESIGNATED 2032
SUBCOMPONENT @910400 /*Additional XP CAP for SoA*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 8000000

COPY_EXISTING ~STARTARE.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910404 /*Custom value*/
DESIGNATED 2033
SUBCOMPONENT @910400 /*Additional XP CAP for SoA*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPCapSoA) OR (NOT IS_AN_INT XPCapSoA) OR (XPCapSoA < 1) BEGIN
	PRINT @980000 /*Type in the integer value for XP CAP*/
	ACTION_READLN XPCapSoA
END

OUTER_SET value = XPCapSoA

COPY_EXISTING ~STARTARE.2DA~ ~override~
	REPLACE_TEXTUALLY ~\(START_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	REPLACE_TEXTUALLY ~\(START_MP_XP_CAP[ %TAB%]+\)[-0-9]+~ ~\1%value%~
	PRETTY_PRINT_2DA
BUT_ONLY

/////                                                  \\\\\
///// XP for Traps, Spells and Lockpicking             \\\\\
/////                                                  \\\\\

BEGIN @910501 /*BG1 values (default)*/
DESIGNATED 2040
SUBCOMPONENT @910500 /*XP for Traps, Spells and Lockpicking*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 7 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 8 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 9 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 10 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 11 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 12 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 13 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 14 @990002 /*Similar tweak already installed*/

OUTER_SPRINT DISARM_TRAP ~DISARM_TRAP   10   10   10   10   10   17   17   17   17   17   27   27   27   27   27   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32   32~
OUTER_SPRINT PICK_LOCK   ~PICK_LOCK     25   25   25   25   25   40   40   40   40   40   95   95   95   95   95   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15   15~
OUTER_SPRINT LEARN_SPELL ~LEARN_SPELL   10   20   30   40   50   60   70   80   90   0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0~

COPY_EXISTING ~XPBONUS.2DA~ ~override~
	PRETTY_PRINT_2DA
	REPLACE_TEXTUALLY ~DISARM_TRAP.+$~ ~%DISARM_TRAP%~
	REPLACE_TEXTUALLY ~PICK_LOCK.+$~   ~%PICK_LOCK%~
	REPLACE_TEXTUALLY ~LEARN_SPELL.+$~ ~%LEARN_SPELL%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910502 /*BG2 values*/
DESIGNATED 2041
SUBCOMPONENT @910500 /*XP for Traps, Spells and Lockpicking*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 7 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 8 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 9 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 10 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 11 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 12 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 13 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 14 @990002 /*Similar tweak already installed*/

OUTER_SPRINT DISARM_TRAP ~DISARM_TRAP   1000 1000 1000 1000 1000 1750 1750 1750 1750 1750 2750 2750 2750 2750 2750 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250~
OUTER_SPRINT PICK_LOCK   ~PICK_LOCK     250  250  250  250  250  400  400  400  400  400  950  950  950  950  950  1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550~
OUTER_SPRINT LEARN_SPELL ~LEARN_SPELL   1000 2000 3000 4000 5000 6000 7000 8000 9000 0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0~

COPY_EXISTING ~XPBONUS.2DA~ ~override~
	PRETTY_PRINT_2DA
	REPLACE_TEXTUALLY ~DISARM_TRAP.+$~ ~%DISARM_TRAP%~
	REPLACE_TEXTUALLY ~PICK_LOCK.+$~   ~%PICK_LOCK%~
	REPLACE_TEXTUALLY ~LEARN_SPELL.+$~ ~%LEARN_SPELL%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910503 /*Vanilla friendly progressive*/
DESIGNATED 2042
SUBCOMPONENT @910500 /*XP for Traps, Spells and Lockpicking*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 7 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 8 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 9 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 10 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 11 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 12 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 13 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 14 @990002 /*Similar tweak already installed*/

OUTER_SPRINT DISARM_TRAP ~DISARM_TRAP   10   10   10   10   10   17   17   17   17   17   270  350  450  550  650  750  850  950  1050 1150 1250 1350 1450 1550 1650 1750 1850 1950 2050 2150 2250 2450 2550 2650 2750 2850 2950 3050 3150 3250~
OUTER_SPRINT PICK_LOCK   ~PICK_LOCK     25   25   25   25   25   40   40   40   40   40   100  150  200  250  300  350  400  450  500  550  600  650  700  750  800  850  900  950  1000 1050 1100 1150 1200 1250 1300 1350 1400 1450 1500 1550~
OUTER_SPRINT LEARN_SPELL ~LEARN_SPELL   10   20   30   40   250  500  1000 2000 4000 0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0~
//OUTER_SPRINT DISARM_TRAP ~DISARM_TRAP   10   10   20   40   80   160  280  440  640  880  1760 1760 2750 2750 2750 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250 3250~
//OUTER_SPRINT PICK_LOCK   ~PICK_LOCK     20   20   40   60   80   120  170  220  280  350  480  650  880  1070 1250 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550 1550~
//OUTER_SPRINT LEARN_SPELL ~LEARN_SPELL   100  400  900  1600 2500 3600 4900 6400 8100 0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0    0~

COPY_EXISTING ~XPBONUS.2DA~ ~override~
	PRETTY_PRINT_2DA
	REPLACE_TEXTUALLY ~DISARM_TRAP.+$~ ~%DISARM_TRAP%~
	REPLACE_TEXTUALLY ~PICK_LOCK.+$~   ~%PICK_LOCK%~
	REPLACE_TEXTUALLY ~LEARN_SPELL.+$~ ~%LEARN_SPELL%~
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910504 /*Disabled*/
DESIGNATED 2043
SUBCOMPONENT @910500 /*XP for Traps, Spells and Lockpicking*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 7 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 8 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 9 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 10 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 11 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 12 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 13 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 14 @990002 /*Similar tweak already installed*/

OUTER_SET value = 0

COPY_EXISTING ~XPBONUS.2DA~ ~override~
	COUNT_2DA_COLS "cntcol"
	COUNT_2DA_ROWS "%cntcol%" "cntrows"
	FOR (cnt = 0; cnt < "%cntrows%"; cnt = cnt + 1) BEGIN
		FOR (cnt2 = 1; cnt2 < "%cntcol%"; cnt2 = cnt2 + 1) BEGIN
			READ_2DA_ENTRY cnt cnt2 "%cntcol%" "XP_value"
			PATCH_IF ("%XP_value%" > 0) BEGIN
				SET XP_value = ("%XP_value%" * "%value%" / 100)
				PATCH_IF ("%XP_value%" < 1) BEGIN
					SET XP_value = 1
				END
				SET_2DA_ENTRY cnt cnt2 cntcol ~%XP_value%~
			END
		END
	END
	PRETTY_PRINT_2DA
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910505 /*Custom value*/
DESIGNATED 2044
SUBCOMPONENT @910500 /*XP for Traps, Spells and Lockpicking*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 7 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 8 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 9 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 10 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 11 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 12 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 13 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 14 @990002 /*Similar tweak already installed*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPActions) OR (NOT IS_AN_INT XPActions) OR (XPActions < 1) BEGIN
	PRINT @980001 /*Type in the integer percentage value*/
	ACTION_READLN XPActions
END

OUTER_SET value = XPActions

COPY_EXISTING ~XPBONUS.2DA~ ~override~
	COUNT_2DA_COLS "cntcol"
	COUNT_2DA_ROWS "%cntcol%" "cntrows"
	FOR (cnt = 0; cnt < "%cntrows%"; cnt = cnt + 1) BEGIN
		FOR (cnt2 = 1; cnt2 < "%cntcol%"; cnt2 = cnt2 + 1) BEGIN
			READ_2DA_ENTRY cnt cnt2 "%cntcol%" "XP_value"
			PATCH_IF ("%XP_value%" > 0) BEGIN
				SET XP_value = ("%XP_value%" * "%value%" / 100)
				PATCH_IF ("%XP_value%" < 1) BEGIN
					SET XP_value = 1
				END
				SET_2DA_ENTRY cnt cnt2 cntcol ~%XP_value%~
			END
		END
	END
	PRETTY_PRINT_2DA
BUT_ONLY

/////                                                  \\\\\
///// XP for killing creatures                         \\\\\
/////                                                  \\\\\

BEGIN @910601 /*Increase to 150%*/
DESIGNATED 2050
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_SET value = 150

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910602 /*Decrease to 75%*/
DESIGNATED 2051
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_SET value = 75

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910603 /*Decrease to 50%*/
DESIGNATED 2052
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_SET value = 50

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910604 /*Decrease to 25%*/
DESIGNATED 2053
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_SET value = 25

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910605 /*Decrease to 10%*/
DESIGNATED 2054
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_SET value = 10

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910606 /*Disable*/
DESIGNATED 2055
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_SET value = 0

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910607 /*Custom value*/
DESIGNATED 2056
SUBCOMPONENT @910600 /*XP for killing creatures*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 0 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 1 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 2 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 3 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 4 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 5 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 6 @990002 /*Similar tweak already installed*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPCreatures) OR (NOT IS_AN_INT XPCreatures) OR (XPCreatures < 1) BEGIN
	PRINT @980001 /*Type in the integer percentage value*/
	ACTION_READLN XPCreatures
END

OUTER_SET value = XPCreatures

COPY_EXISTING_REGEXP GLOB ~.+\.CRE~ ~override~
	READ_LONG 0x14 "XP_value"
	PATCH_IF ("%XP_value%" > 0) BEGIN
		SET print = "%XP_value%"
		PATCH_IF ("%value%" > 0) BEGIN
			SET XP_value = ("%XP_value%" * "%value%" / 100)
			PATCH_IF ("%XP_value%" < 1) BEGIN
				SET XP_value = 1
			END
			WRITE_LONG 0x14 "%XP_value%"
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => %XP_value%~
		END ELSE BEGIN
			WRITE_LONG 0x14 0
			PATCH_PRINT ~Patching %SOURCE_FILE%: %print% => 0~
		END
	END
BUT_ONLY

/////                                                  \\\\\
///// XP for quests                                    \\\\\
/////                                                  \\\\\

BEGIN @910701 /*Increase to 150%*/
DESIGNATED 2060
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_SET value = 150

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910702 /*Decrease to 75%*/
DESIGNATED 2061
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_SET value = 75

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910703 /*Decrease to 50%*/
DESIGNATED 2062
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_SET value = 50

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910704 /*Decrease to 25%*/
DESIGNATED 2063
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_SET value = 25

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910705 /*Decrease to 10%*/
DESIGNATED 2064
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_SET value = 10

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910706 /*Disable*/
DESIGNATED 2065
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_SET value = 0

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @910707 /*Custom value*/
DESIGNATED 2066
SUBCOMPONENT @910700 /*XP for quests*/
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 15 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 16 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 17 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 18 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 19 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 20 @990002 /*Similar tweak already installed*/
FORBID_COMPONENT ~xpmod/setup-xpmod.tp2~ 21 @990002 /*Similar tweak already installed*/

OUTER_WHILE (NOT VARIABLE_IS_SET XPQuests) OR (NOT IS_AN_INT XPQuests) OR (XPQuests < 1) BEGIN
	PRINT @980001 /*Type in the integer percentage value*/
	ACTION_READLN XPQuests
END

OUTER_SET value = XPQuests

INCLUDE ~EET_Tweaks/lib/xp_quests.tph~

/////                                                  \\\\\
///// Party XP for quests distributed individually     \\\\\
/////                                                  \\\\\

BEGIN @910800 /*Party XP for quests distributed individually*/
DESIGNATED 2070
GROUP @910000 /*XP adjustments*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/

COPY_EXISTING ~XPLIST.2da~ ~override~
	COUNT_2DA_COLS "cntcol"
	COUNT_2DA_ROWS "%cntcol%" "cntrows"
	FOR (cnt = 0; cnt < "%cntrows%"; cnt = cnt + 1) BEGIN
		READ_2DA_ENTRY cnt 0 "%cntcol%" "name"
		PATCH_PRINT ~Analysing '%name%' XPLIST.2da row~
		FOR (cnt2 = 2; cnt2 < "%cntcol%"; cnt2 = cnt2 + 1) BEGIN
			READ_2DA_ENTRY cnt cnt2 "%cntcol%" "XP_value"
			PATCH_IF NOT (IS_AN_INT %XP_value%) BEGIN
				SPRINT print "%XP_value%"
				INNER_PATCH_SAVE ~XP_value~ ~%XP_value%~ BEGIN
					REPLACE_TEXTUALLY ~P_~ ~~
				END
				PATCH_IF ("%XP_value%" > 0) BEGIN
					SET XP_value = ("%XP_value%" / 6)
					PATCH_IF ("%XP_value%" < 1) BEGIN
						SET XP_value = 1
					END
					SET_2DA_ENTRY cnt cnt2 cntcol ~%XP_value%~
					PATCH_PRINT ~Patching XPLIST.2da (row%cnt%, col%cnt2%): %print% => %XP_value%~
				END
			END
		END
	END
	PRETTY_PRINT_2DA
BUT_ONLY

ACTION_FOR_EACH ext IN BCS DLG BEGIN
	COPY_EXISTING_REGEXP GLOB ~.+\.%ext%~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			REPLACE_EVALUATE CASE_INSENSITIVE ~AddexperienceParty(\([1-9][0-9]*\))~ BEGIN
				SET "XP_value" = "%MATCH1%"
				PATCH_IF ("%XP_value%" > 0) BEGIN
					SET XP_value = ("%XP_value%" / 6)
					PATCH_IF ("%XP_value%" < 1) BEGIN
						SET XP_value = 1
					END
					PATCH_PRINT ~Patching %SOURCE_FILE%: %MATCH1% => %XP_value% (for Player1-6)~
				END
			END
			~AddXPObject(Player1,%XP_value%)
    AddXPObject(Player2,%XP_value%)
    AddXPObject(Player3,%XP_value%)
    AddXPObject(Player4,%XP_value%)
    AddXPObject(Player5,%XP_value%)
    AddXPObject(Player6,%XP_value%)~
		END
	BUT_ONLY
END

/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////                                                  \\\\\
///// Gameplay                                         \\\\\
/////                                                  \\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\

/////                                                  \\\\\
///// Disable hostile reaction after charm             \\\\\
/////                                                  \\\\\

BEGIN @920100 /*Disable hostile reaction after charm*/
DESIGNATED 3000
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~Setup-BGTTweak.tp2~ 2300 @990002 /*Similar tweak already installed*/

COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
	~^.+\.spl$~ ~override~
	PATCH_IF (("%SOURCE_RES%" STRING_EQUAL_CASE "spwi939")=0) AND ("%SOURCE_SIZE%" > 0x71) BEGIN
		READ_LONG 0x64 abil_off
		READ_SHORT 0x68 abil_num
		READ_LONG 0x6a fx_off
		PATCH_IF ("%SOURCE_FILE%" STRING_COMPARE_REGEXP "^.+\.spl$" = 0) BEGIN
			SET "abil_length" = 0x28
		END ELSE BEGIN
			SET "abil_length" = 0x38
		END
		FOR (index = 0 ; index < abil_num ; index = index + 1) BEGIN
			READ_SHORT ("%abil_off%" + 0x1e + ("%abil_length%" * "%index%")) "abil_fx_num"
			READ_SHORT ("%abil_off%" + 0x20 + ("%abil_length%" * "%index%")) "abil_fx_idx"
			FOR (index2 = 0 ; index2 < abil_fx_num ; index2 = index2 + 1) BEGIN
				READ_SHORT ("%fx_off%" + (0x30 * ("%abil_fx_idx%" + "%index2%"))) "opcode"
				PATCH_IF ("%opcode%" = 5) BEGIN // Charm Specific Creature
					READ_BYTE ("%fx_off%" + 0x8 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) "charm_type"
					PATCH_IF ("%charm_type%" = 3) BEGIN
						WRITE_BYTE ("%fx_off%" + 0x8 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 2
					END ELSE PATCH_IF ("%charm_type%" = 1) BEGIN
						WRITE_BYTE ("%fx_off%" + 0x8 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 0
					END
				END
			END
		END
	END
BUT_ONLY

COPY_EXISTING_REGEXP GLOB ~^.+\.eff$~ ~override~
	PATCH_IF ("%SOURCE_SIZE%" > 0x109) BEGIN
		READ_SHORT 0x10 "opcode"
		PATCH_IF "%opcode%" = 5 BEGIN // Charm Specific Creature
			READ_BYTE 0x20 "charm_type"
			PATCH_IF ("%charm_type%" = 3) BEGIN
				WRITE_BYTE 0x20 2
			END ELSE PATCH_IF ("%charm_type%" = 1) BEGIN
				WRITE_BYTE 0x20 0
			END
		END
	END
BUT_ONLY

/////                                                  \\\\\
///// PnP spell scroll caster levels (by AstroBryGuy)  \\\\\
/////                                                  \\\\\

BEGIN @920200 /*PnP spell scroll caster levels*/
DESIGNATED 3010
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
REQUIRE_PREDICATE NOT FILE_EXISTS_IN_GAME ~cdt02170.g3~ @990003 /*Conflicting BG2 Tweaks component detected: Cast Spells from Scrolls at Character Level*/

COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
	READ_SHORT  0x1C "type" ELSE 0
	PATCH_IF ("%type%" = 11) BEGIN // scrolls
		READ_LONG  0x64 "abil_off" ELSE 0
  		READ_SHORT 0x68 "abil_num" ELSE 0
		READ_LONG  0x6a "fx_off"   ELSE 0
  		FOR (index = 0 ; index < abil_num ; index = index + 1) BEGIN
    		READ_BYTE ("%abil_off%" + (0x38 * "%index%")) "type"
			PATCH_IF ("%type%" = 3) BEGIN // magical
      			READ_SHORT ("%abil_off%" + 0x1e + (0x38 * "%index%")) "abil_fx_num"
      			READ_SHORT ("%abil_off%" + 0x20 + (0x38 * "%index%")) "abil_fx_idx"
      			FOR (index2 = 0 ; index2 < abil_fx_num ; index2 = index2 + 1) BEGIN
        			READ_SHORT ("%fx_off%" +        (0x30 * ("%abil_fx_idx%" + "%index2%"))) "opcode"
        			PATCH_IF (("%opcode%" = 146) OR ("%opcode%" = 148)) BEGIN // cast spell
          				READ_ASCII ("%fx_off%" + 0x14 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) "resource" ELSE "AAAA000"
          				PATCH_MATCH ~%resource%~
          				WITH
          					// Wizard Spells
          					~[Ss][Pp][Ww][Ii][1-3][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 6 // cast at 6th level
          					END
          					~[Ss][Pp][Ww][Ii][4][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 8 // cast at 8th level
          					END
          					~[Ss][Pp][Ww][Ii][5][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 10 // cast at 10th level
          					END
          					~[Ss][Pp][Ww][Ii][6][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 13 // cast at 13th level
          					END
          					~[Ss][Pp][Ww][Ii][7][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 15 // cast at 15th level
          					END
          					~[Ss][Pp][Ww][Ii][8][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 17 // cast at 17th level
          					END
          					~[Ss][Pp][Ww][Ii][9][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 19 // cast at 19th level
          					END
          					// Priest Spells
          					~[Ss][Pp][Pp][Rr][1-3][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 6 // cast at 6th level
          					END
          					~[Ss][Pp][Pp][Rr][4][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 8 // cast at 8th level
          					END
          					~[Ss][Pp][Pp][Rr][5][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 10 // cast at 10th level
          					END
          					~[Ss][Pp][Pp][Rr][6][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 12 // cast at 12th level
          					END
          					~[Ss][Pp][Pp][Rr][7][0-9][0-9]~
          					BEGIN
          						WRITE_LONG ("%fx_off%" + 0x04 + (0x30 * ("%abil_fx_idx%" + "%index2%"))) 15 // cast at 15th level
          					END
          					DEFAULT
          				END
        			END
      			END
    		END
  		END
  	END
BUT_ONLY

/////                                                  \\\\\
///// Familiar death consequences                      \\\\\
/////                                                  \\\\\

BEGIN @920301 /*Constitution loss & blocked summoning for 1 week*/
DESIGNATED 3020
SUBCOMPONENT @920300 /*Familiar death consequences*/
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

<<<<<<<< .../K#FAMSUM-et.baf
IF
  GlobalTimerNotExpired("K#TimerFamiliar","GLOBAL")
THEN
  RESPONSE #100
	VerbalConstant(Player1,SPELL_DISRUPTED)
    DestroySelf()
END
>>>>>>>>
EXTEND_TOP ~K#FAMSUM.BCS~ ~.../K#FAMSUM-et.baf~

COPY_EXISTING ~K#FAMKIL.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		REPLACE_TEXTUALLY ~ActionOverride(Player1,DisplayString(Myself,21004))~ ~SetGlobalTimer("K#TimerFamiliar","GLOBAL",50400)~
		REPLACE_TEXTUALLY ~ChangeStat(Player1,CON,-1,ADD)~ ~ActionOverride(Player1,ApplySpellRES("K#FAMCON",Myself))~
	END
BUT_ONLY

COPY ~EET_Tweaks/base/familiar/K#FAMCON.SPL~ ~override~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @920302 /*Constitution loss for 1 week*/
DESIGNATED 3021
SUBCOMPONENT @920300 /*Familiar death consequences*/
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

COPY_EXISTING ~K#FAMKIL.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		REPLACE_TEXTUALLY ~ActionOverride(Player1,DisplayString(Myself,21004))~ ~~
		REPLACE_TEXTUALLY ~ChangeStat(Player1,CON,-1,ADD)~ ~ActionOverride(Player1,ApplySpellRES("K#FAMCON",Myself))~
	END
BUT_ONLY

COPY ~EET_Tweaks/base/familiar/K#FAMCON.SPL~ ~override~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @920303 /*Disabled*/
DESIGNATED 3022
SUBCOMPONENT @920300 /*Familiar death consequences*/
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

COPY_EXISTING ~K#FAMKIL.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		REPLACE_TEXTUALLY ~ActionOverride(Player1,DisplayString(Myself,21004))~ ~~
		REPLACE_TEXTUALLY ~ChangeStat(Player1,CON,-1,ADD)~ ~~
	END
BUT_ONLY

/////                                                  \\\\\
///// Protagonist can die                              \\\\\
/////                                                  \\\\\

BEGIN @920400 /*Protagonist can die*/
DESIGNATED 3030
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~bg2ee eet~ @990000 /*This component is not compatible with your game*/

APPEND ~ACTION.IDS~ ~366 GameOver(I:StrRef*)~ UNLESS ~366 GameOver(I:StrRef*)~

COPY_EXISTING_REGEXP GLOB ~^.+\.are$~ ~override~
	READ_BYTE 0x14 "flags"
	WRITE_BYTE 0x14 ("%flags%" BOR BIT4)
BUT_ONLY

<<<<<<<< .../baldur-et.baf
IF
  Global("K#DISABLE_PC_CAN_DIE","GLOBAL",1)
  StateCheck(Player1,STATE_REALLY_DEAD)
THEN
  RESPONSE #100
    GameOver(19377)
END

IF
  OR(3)
    NumInPartyAlive(0)
    StateCheck(Player1,STATE_EXPLODING_DEATH)
    StateCheck(Player1,STATE_FROZEN_DEATH)
THEN
  RESPONSE #100
    GameOver(19377)
END
>>>>>>>>

ACTION_FOR_EACH file IN BALDUR BALDUR25 BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.BCS~ BEGIN
		ACTION_DEFINE_ASSOCIATIVE_ARRAY WORLDSCRIPT_list BEGIN ~%file%~ => ~~ END
	END
END

ACTION_IF FILE_EXISTS_IN_GAME ~campaign.2da~ BEGIN
	COPY_EXISTING - ~campaign.2da~ ~.../campaign.2da~
		COUNT_2DA_ROWS 32 "cntrow"
		FOR (cnt = 0; cnt < "%cntrow%"; cnt = cnt + 1) BEGIN
			READ_2DA_ENTRY cnt 1 32 "file"
			PATCH_IF (NOT ~%file%~ STR_EQ ~*~) AND (FILE_EXISTS_IN_GAME ~%file%.BCS~) BEGIN
				DEFINE_ASSOCIATIVE_ARRAY WORLDSCRIPT_list BEGIN ~%file%~ => ~~ END
			END
		END
END

ACTION_PHP_EACH WORLDSCRIPT_list AS file => dummy BEGIN
	EXTEND_TOP ~%file%.BCS~ ~.../baldur-et.baf~ EVALUATE_BUFFER
END

/////                                                  \\\\\
///// Ironman Mode                                     \\\\\
/////                                                  \\\\\

BEGIN @920500 /*Ironman Mode*/
DESIGNATED 3040
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/
DEPRECATED ~This component is currently broken: http://forum.baldursgate.com/discussion/40487/opcode-338-disable-rest-or-save-seems-to-be-partially-broken~

/////                                                  \\\\\
///// One time area spawn points (no respawning)       \\\\\
/////                                                  \\\\\

BEGIN @920600 /*One time area spawn points (no respawning)*/
DESIGNATED 3050
GROUP @920000 /*Gameplay*/
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee eet~ @990000 /*This component is not compatible with your game*/

COPY_EXISTING_REGEXP GLOB ~.+\.are~ ~override~
	READ_LONG 0x60 spawn_off
	READ_SHORT 0x64 spawn_num
	FOR (i=0 ; i<"%spawn_num%"; i=i+1) BEGIN
		WRITE_SHORT ("%spawn_off%" + i*0xc8 + 0x7a) (THIS | BIT1)
	END
BUT_ONLY

/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////                                                  \\\\\
///// Miscellaneous                                    \\\\\
/////                                                  \\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\
/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\/////\\\\\

/////                                                  \\\\\
///// Add Priest of Tempus kit for Priests             \\\\\
/////                                                  \\\\\

BEGIN @930100 /*Add Priest of Tempus kit for Priests*/
DESIGNATED 4000
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee eet~ @990000 /*This component is not compatible with your game*/
REQUIRE_PREDICATE NOT FILE_EXISTS_IN_GAME ~ohtempus.2da~ @990004 /*This kit is already in the game*/

LOAD_TRA ~EET_Tweaks/lang/%LANGUAGE%/tempus.tra~

ACTION_IF GAME_IS ~bgee~ BEGIN
	OUTER_SET kit_biography = 15884
	OUTER_SET kit_briefdesc = 31255
END ELSE ACTION_IF GAME_IS ~bg2ee~ BEGIN
	OUTER_SET kit_biography = ~-1~
	OUTER_SET kit_briefdesc = 102495
END ELSE BEGIN //eet
	OUTER_SET kit_biography = 215884
	OUTER_SET kit_briefdesc = 231255
END

ADD_KIT ~OHTEMPUS~
	// CLASS WEAPON PROFICIENCIES_____
	//                 S L            
	//                 M A            
	//                 A R            
	//                 L G   M        
	//                 L E   I   S    
	//                 S S B S   P   S
	//                 W W L S   I   P
	//                 O O U I B K A E
	//                 R R N L O E X A
	// CLASWEAP.2DA    D D T E W D E R
	~OHTEMPUS          0 0 1 1 0 1 0 0~
	// WEAPON PROFICIENCIES_________________________________________________________________________________________________
	//                                         T   S           F   Q             S S                                        
	//                 L S                     W   C           L   U             W I                                        
	//                 A M             B L S   O   I   W       A   A             O N                                        
	//                 R A             A O H   H   M   A       I   R C   S       R G                                        
	//                 G L           M S N O   A   I   R     H L   T R L H     2 D L 2                 E E E E E E E E E E E
	//                 E L       S   I T G R   N K T D H     A M   E O O O     H A E W E E E E E E E E X X X X X X X X X X X
	//                 S S   S B P   S A S T   D A A A A   S L O   R S N R   S A N W E X X X X X X X X T T T T T T T T T T T
	//                 W W   P L I   S R W S   E T R G M C P B R M S S G T D L N D E A T T T T T T T T R R R R R R R R R R R
	//                 O O B E U K A I D O W A D A W G M L E E N A T B B B A I D S A P R R R R R R R R A A A A A A A A A A A
	//                 R R O A N E X L S R O X S N A E E U A R I C A O O O R N E H P O A A A A A A A A 1 1 1 1 1 1 1 1 1 1 2
	// WEAPPROF.2DA    D D W R T D E E W D R E W A K R R B R D N E F W W W T G D I O N 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
	~OHTEMPUS          0 0 0 0 1 1 0 1 0 0 0 0 0 0 0 0 1 1 0 0 1 1 1 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0~
	// MINIMUM KIT STATS______________________
	// ABCLASRQ.2DA    STR DEX CON INT WIS CHR
	~OHTEMPUS          0   0   0   0   9   0~
	// KIT STAT MODIFIERS_____________________
	// ABCLSMOD.2DA    STR DEX CON INT WIS CHR
	~OHTEMPUS          0   0   0   0   0   0~
	// REQUIREMENTS TO DUAL TO THIS KIT_______
	// ABDCDSRQ.2DA    STR DEX CON INT WIS CHR
	~OHTEMPUS          0   0   0   0   17  0~
	// REQUIREMENTS TO DUAL FROM THIS KIT_____
	// ABDCSCRQ.2DA    STR DEX CON INT WIS CHR
	~OHTEMPUS          0   0   0   0   15  0~
	// ALIGNMENT RESTRICTIONS____________________
	// ALIGNMNT.2DA    LG LN LE NG TN NE CG CN CE
	~OHTEMPUS          0  0  0  0  1  0  1  1  1~
	// DUAL CLASS OPTIONS_______________
	// DUALCLASS.2DA   FT CL MA TH DR RA
	~OHTEMPUS          1  0  1  1  0  1~
	// KIT ABILITIES 2DA FILE (path to CLAB-type file)
	~EET_Tweaks/base/tempus/OHTEMPUS.2DA~
	// RACIAL KIT AVAILABILITY____________________________________
	//                                                    H       
	//                                             H      A      H
	//                                             A      L      A
	//                 H      D      G             L      F      L
	//                 U      W      N             F      L      F
	//                 M      A      O      E      E      I      O
	//                 A      R      M      L      L      N      R
	// KITTABLE.2DA    N      F      E      F      F      G      C
	~                  K_C_H  K_C_D  K_C_G  K_C_E  K_C_HE K_C_HL K_C_HO~
	// UNUSABLE FLAGS AND KIT BASE CLASS
	// CLASSES: Mage = 1, Fighter = 2, Cleric=3, Thief = 4, Bard = 5, Paladin 6, Druid = 11, Ranger = 12, Sorcerer = 19, Monk = 20
	// KITLIST.2DA
	~                  0x00004000 3~
	// HIGH LEVEL ABILITIES ABBREVIATION
	// LUABBR.2DA
	~                  Cl0~
	// TOB STARTING EQUIPMENT__________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________
	//                                                                                                                                      B                                                                                                                                 W
	//                              S                                                                C                         A            R                                                                                                                                 E
	//                 A            H                                      R            R            L            B            M            A                         A            A            A            M            M            M            M            M            A
	//                 R            I            H                         I            I            O            O            U            C            B            M            M            M            I            I            I            I            I            P
	//                 M            E            E            B            N            N            A            O            L            E            E            M            M            M            S            S            S            S            S            O
	//                 O            L            L            A            G            G            C            T            E            R            L            O            O            O            C            C            C            C            C            N
	// 25STWEAP.2DA    R            D            M            G            1            2            K            S            T            S            T            1            2            3            1            2            3            4            5            1
	~                  CHAN09       *            HELM07       BAG20        RING06       RING31       *            BOOT01       AMUL19       BRAC16       BELT06       AROW11,40    BULL03,40    BOLT06,40    POTN52,5     POTN04,2     POTN14,5     HAMM07       SW1H27       STAF08~
	// CHARACTER CREATION KIT DESCRIPTION
	// KITLIST.2DA     LOWER
	SAY                @0 /*priest of Tempus*/
	// KITLIST.2DA     MIXED
	SAY                @1 /*Priest of Tempus*/
	// KITLIST.2DA     HELP
	SAY                @2 /*PRIEST OF TEMPUS: Tempus, also known as the Lord of Battles or the Foehammer, is random in his favors, yet his chaotic nature favors all sides equally. Lord Tempus may be on an army's side one day and against them the next; such is the nature of war. Tempuran clergy can be found on both sides of a conflict, as none can ever truly know whom the war god will favor.

Advantages:
- May cast Holy Power once per day. Gains one use at level 1 and an additional use every 5 levels thereafter.
- May cast Chaos of Battle once per day. Gains one use at level 1 and an additional use every 10 levels thereafter.

CHAOS OF BATTLE: Chaos of Battle applies bonuses to all allies and penalties to all enemies within a 60-ft. radius of the caster. The spell lasts 1 turn and will randomly affect the targets' Armor Class, Hit Points, THAC0, saves, or luck. The magnitude of the effect starts at 1 (5 for Hit Points) at level 1 and will improve by 1 (5 for Hit Points) every 6 levels of the caster.

Disadvantages:
– Alignment restricted to chaotic alignments or true neutral.*/

INCLUDE ~EET_Tweaks/lib/fl#add_kit_ee.tpa~
LAF ~fl#add_kit_ee~
	INT_VAR
	//CLASTEXT.2DA       BIOGRAPHY
	    biography     = ~kit_biography~
	//CLASTEXT.2DA       BRIEFDESC
	    briefdesc     = ~kit_briefdesc~
	//CLASTEXT.2DA       FALLEN
	    fallen        = ~0~
	//CLASTEXT.2DA       FALLEN_NOTICE
	    fallen_notice = ~-1~
	STR_VAR
	//internal kit name
	    kit_name      = ~OHTEMPUS~
	//BACKSTAB.2DA       0     1     2     3     4     5     6     7     8     9     10     11     12     13     14     15     16     17     18     19     20     21     22     23     24     25     26     27     28     29     30     31     32     33     34     35     36     37     38     39     40     41     42     43     44     45     46     47     48     49     50
	    //backstab    = ~~
	//CLSWPBON.2DA       GETS_PROF_APR       UNARMED_DIVISOR     ZERO_SKILL_THAC0
	    clswpbon      = ~0                   0                   3~
	//NUMWSLOT.2DA       SLOTS
	    numwslot      = ~2~
	//THIEFSKL.2DA       START_POINTS       LEVEL_POINTS
	    //thiefskl    = ~~
	//TRAPLIMT.2DA       LIMIT
	    //traplimt    = ~~
	//CLASCOLR.2DA       METAL     MINOR_CLOTH     MAIN_CLOTH     LEATHER     ARMOR
	    clascolr      = ~80        126             127            93          97~
	//CLASISKL.2DA       PICK_POCKETS     OPEN_LOCKS     FIND_TRAPS     MOVE_SILENTLY     HIDE_IN_SHADOWS     DETECT_ILLUSION     SET_TRAPS
	    clasiskl      = ~0                0              0              0                 0                   0                   0~
	//THIEFSCL.2DA       PICK_POCKETS     OPEN_LOCKS     FIND_TRAPS     MOVE_SILENTLY     HIDE_IN_SHADOWS     DETECT_ILLUSION     SET_TRAPS     STEALTH
	    thiefscl      = ~0                0              0              0                 0                   0                   0             0~
	//HPCLASS.2DA        TABLE
	    hpclass       = ~HPPRS~
	//CLSRCREQ.2DA       HUMAN               ELF                 HALF_ELF            DWARF               HALFLING            GNOME               HALFORC
	    clsrcreq      = ~1                   1                   1                   1                   1                   1                   1~
	//CLASTHAC.2DA       BONUS
	    clasthac      = ~0~
	//SNEAKATT.2DA       0     1     2     3     4     5     6     7     8     9     10     11     12     13     14     15     16     17     18     19     20     21     22     23     24     25     26     27     28     29     30     31     32     33     34     35     36     37     38     39     40     41     42     43     44     45     46     47     48     49     50
	    //sneakatt    = ~~
	//CRIPPSTR.2DA       0     1     2     3     4     5     6     7     8     9     10     11     12     13     14     15     16     17     18     19     20     21     22     23     24     25     26     27     28     29     30     31     32     33     34     35     36     37     38     39     40     41     42     43     44     45     46     47     48     49     50
	    //crippstr    = ~~
END

ACTION_FOR_EACH file IN CLASWEAP WEAPPROF ABCLASRQ ABCLSMOD ABDCDSRQ ABDCSCRQ ALIGNMNT DUALCLAS KITTABLE KITLIST LUABBR 25STWEAP CLASTEXT BACKSTAB CLSWPBON NUMWSLOT THIEFSKL TRAPLIMT CLASCOLR CLASISKL THIEFSCL HPCLASS CLSRCREQ CLASTHAC SNEAKATT CRIPPSTR K_C_H K_C_D K_C_G K_C_E K_C_HE K_C_HL K_C_HO BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.2da~ BEGIN
		COPY_EXISTING ~%file%.2da~ ~override~
			PRETTY_PRINT_2DA
		BUT_ONLY
	END
END

COPY ~EET_Tweaks/base/tempus/ohtmps1.spl~ ~override~
	SAY 0x8 @3 /*Holy Power*/
	SAY 0x50 @4 /*Holy Power
(Evocation)

Level: 4
Range: 0
Duration: 1 round/level (at least 7 rounds)
Casting Time: 6
Area of Effect: The caster
Saving Throw: None

Through this spell, the caster imbues <PRO_HIMHER>self with the strength and skill of a Fighter of the same level. The priest's Strength is set to 18/00—even if it is normally higher—<PRO_HISHER> THAC0 becomes that of a Fighter of the same level, and <PRO_HESHE> gains 1 temporary Hit Point per level. This will last for the duration of the spell or until dispelled.*/

COPY ~EET_Tweaks/base/tempus/ohtmps2.spl~ ~override~
	SAY 0x8 @5 /*Chaos of Battle*/
	SAY 0x50 @6 /*Chaos of Battle

Chaos of Battle applies bonuses to all allies and penalties to all enemies within a 60-ft. radius of the caster. The spell lasts 1 turn and will randomly affect the targets' Armor Class, Hit Points, THAC0, saves, or luck. The magnitude of the effect starts at 1 (5 for Hit Points) at level 1 and will improve by 1 (5 for Hit Points) every 6 levels of the caster.*/

ADD_PROJECTILE ~EET_Tweaks/base/tempus/ohvrpo.PRO~
COPY ~EET_Tweaks/base/tempus/ohtmps2d.spl~ ~override~
	PATCH_FOR_EACH offset IN 0x1ce 0x4ce 0x7ce 0xace 0xdce BEGIN
		SAY offset @7 /*Combat Bonuses*/
	END
	PATCH_FOR_EACH offset IN 0x98 0xc0 0xe8 0x110 0x138 BEGIN
		WRITE_SHORT offset ohvrpo
	END

ADD_PROJECTILE ~EET_Tweaks/base/tempus/ohvrnp.PRO~
COPY ~EET_Tweaks/base/tempus/ohtmps2e.spl~ ~override~
	PATCH_FOR_EACH offset IN 0x1ce 0x4ce 0x7ce 0xace 0xdce BEGIN
		SAY offset @8 /*Combat Penalties*/
	END
	PATCH_FOR_EACH offset IN 0x98 0xc0 0xe8 0x110 0x138 BEGIN
		WRITE_SHORT offset ohvrnp
	END

COPY ~EET_Tweaks/base/tempus/OHTMPSHS.spl~ ~override~

COPY ~EET_Tweaks/base/tempus/OHTMPSHS.itm~ ~override~
	SAY 0xc @9 /*Holy Symbol of Tempus*/
	SAY 0x54 @10 /*Only the most worthy and devoted servants of the Lord of Battles are granted these powerful holy symbols. 

STATISTICS:

Equipped abilities:
– Strength: +1
– Magic Resistance: +5%
– Can memorize one extra 6th- and 7th-level Cleric spell

Weight: 0*/

ACTION_FOR_EACH ext IN BAM VVC WAV BEGIN
	ACTION_BASH_FOR ~EET_Tweaks/base/tempus~ ~.*\.%ext%$~ BEGIN
		ACTION_IF NOT FILE_EXISTS_IN_GAME ~%BASH_FOR_FILE%~ BEGIN
			COPY ~%BASH_FOR_FILESPEC%~ ~override~
		END
	END
END

COPY ~EET_Tweaks/base/tempus/OHTEMPUS.2DA~ ~override~

/////                                                  \\\\\
///// More bandit scalps                               \\\\\
/////                                                  \\\\\

BEGIN @930200 /*More bandit scalps*/
DESIGNATED 4010
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~bgee eet bgt~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~Setup-BGTTweak.tp2~ 1400 @990002 /*Similar tweak already installed*/

ACTION_FOR_EACH cre IN britik credus hakt raiken taugos tersus teven vax venkt zal BEGIN
	COPY_EXISTING ~%cre%.cre~ ~override~
		READ_LONG 0x2b8 itemslot_off
		READ_LONG 0x2bc item_off
		READ_LONG 0x2c0 item_num
		SET item_found = 0
		FOR (i = 0; i < %item_num%; i +=1) BEGIN
			READ_ASCII (%item_off% + %i% * 0x14) item_name
			PATCH_IF (("%item_name%" STRING_COMPARE_REGEXP "MISC86.*")=0) BEGIN
				FOR (j = 0; j < 37; j += 1) BEGIN
					READ_SHORT (%itemslot_off% + %j% * 0x2) itemslot_idx
					PATCH_IF %itemslot_idx% = %i% BEGIN
						SET item_found = 1
					END
				END
			END
		END
		PATCH_IF item_found = 0 BEGIN
			ADD_CRE_ITEM ~MISC86~ #0 #0 #0 ~UNSTEALABLE~ ~INV~
		END
	BUT_ONLY
END

/////                                                  \\\\\
///// FPS & cutscenes audio adjustment                 \\\\\
/////                                                  \\\\\

BEGIN @930301 /*60 FPS*/
DESIGNATED 4020
SUBCOMPONENT @930300 /*FPS & cutscenes audio adjustment*/
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 60

INCLUDE ~EET_Tweaks/lib/fps.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @930302 /*45 FPS*/
DESIGNATED 4021
SUBCOMPONENT @930300 /*FPS & cutscenes audio adjustment*/
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/

OUTER_SET value = 45

INCLUDE ~EET_Tweaks/lib/fps.tph~

//////////////////////////////\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

BEGIN @930303 /*Custom value*/
DESIGNATED 4022
SUBCOMPONENT @930300 /*FPS & cutscenes audio adjustment*/
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt ca iwd_in_bg2 bgee bg2ee iwdee eet~ @990000 /*This component is not compatible with your game*/

OUTER_WHILE (NOT VARIABLE_IS_SET frames) OR (NOT IS_AN_INT frames) OR (frames < 1) BEGIN
	PRINT @980002 /*Type in integer frames count (30-60)*/
	ACTION_READLN frames
END

OUTER_SET value = frames

INCLUDE ~EET_Tweaks/lib/fps.tph~

/////                                                  \\\\\
///// Remove junk from global scripts                  \\\\\
/////                                                  \\\\\

BEGIN @930400 /*Remove junk from global scripts*/
DESIGNATED 4030
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~bg2ee eet~ @990000 /*This component is not compatible with your game*/

<<<<<<<< .../K#DROWIT-et.baf
IF
  HasItem("%MATCH1%",%MATCH2%)
THEN
  RESPONSE #100
    TakeItemReplace("DWDUST","%MATCH1%",%MATCH2%)
END
>>>>>>>>

COPY - ~.../blank.txt~ ~.../blank.baf~

OUTER_SPRINT log ~~
COPY_EXISTING ~BALDUR.BCS~ ~override~
	~BALDUR25.BCS~ ~override~
	SET skip_HolySymbols = 0
	REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/HolySymbols.baf~ ~.../blank.baf~ ON_MISMATCH SET skip_HolySymbols = 1 SPRINT log ~%log%Skipping Holy Symbols tweak, some other mod already changed the default implementation.%LNL%~ END
	SET skip_Lilarcor = 0
	REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/Lilarcor.baf~ ~.../blank.baf~ ON_MISMATCH SET skip_Lilarcor = 1 SPRINT log ~%log%Skipping Lilarcor tweak, some other mod already changed the default implementation.%LNL%~ END
	PATCH_IF ~%SOURCE_RES%~ STRING_EQUAL_CASE ~BALDUR~ BEGIN
		//Unused test script blocks
		REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/Unused.baf~ ~.../blank.baf~ ON_MISMATCH SPRINT log ~%log%Skipping unused test script blocks cleaning, some other mod already changed the default implementation.%LNL%~ END
		//Malchior Harpell´s appearance
		SET skip_Harpell = 0
		PATCH_IF (FILE_EXISTS_IN_GAME ~cdt03160.g3~) BEGIN //BG2 Tweaks "Keep Drizzt's Loot, Disable Malchor Harpell" component detected
			REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/compat/bg2tweaks/Harpell.baf~ ~.../blank.baf~ ON_MISMATCH SET skip_Harpell = 1 SPRINT log ~%log%Skipping Malchior Harpell tweak, some other mod already changed the default implementation.%LNL%~ END
		END ELSE BEGIN
			REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/Harpell.baf~ ~.../blank.baf~ ON_MISMATCH SET skip_Harpell = 1 SPRINT log ~%log%Skipping Malchior Harpell tweak, some other mod already changed the default implementation.%LNL%~ END
		END
	END ELSE BEGIN
		//Unused Familiar script blocks with wrong DV
		REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/Familiar.baf~ ~.../blank.baf~ ON_MISMATCH SPRINT log ~%log%Skipping unused Familiar code cleaning, some other mod already changed the default implementation.%LNL%~ END
	END
	DECOMPILE_AND_PATCH BEGIN
		//Lilarcor (talking sword)
		PATCH_IF (skip_Lilarcor = 0) BEGIN
			COUNT_REGEXP_INSTANCES ~DisplayStringHeadOwner("sw2h14",20580)~ num_matches
			PATCH_IF (num_matches > 0) BEGIN
				PATCH_WARN ~WARNING: DisplayStringHeadOwner("sw2h14",20580) still found in %SOURCE_FILESPEC% after patching. Some other mod may have changed Lilarcor script blocks. Consider uninstalling this component if you can't analyse it yourself and/or send %SOURCE_FILESPEC% and weidu.log to me.~
			END
		END
		//Cleric's Holy Symbols
		PATCH_IF (skip_HolySymbols = 0) BEGIN
			PATCH_FOR_EACH match IN BELT14 BELT13 BELT12 BEGIN
				COUNT_REGEXP_INSTANCES ~TransformItem("CDHLYSYM","%match%")~ num_matches
				PATCH_IF (num_matches > 0) BEGIN
					PATCH_WARN ~WARNING: %match% still found %num_matches% times in %SOURCE_FILESPEC% after patching. Some other mod may have changed Cleric's Holy Symbols script blocks. Consider uninstalling this component if you can't analyse it yourself and/or send %SOURCE_FILESPEC% and weidu.log to me.~
				END
			END
		END
		PATCH_IF ~%SOURCE_RES%~ STRING_EQUAL_CASE ~BALDUR25~ BEGIN
			//Drow items changing to dust on surface
			SET skip_DROWIT = 0
			SPRINT textToReplace ~IF[%newline%]*Global("oh_drow_items_safe","GLOBAL",0)[%newline%]*HasItem("\(.+\)",\(Player.\))[%newline%]*THEN[%newline%]*RESPONSE #100[%newline%]*TakeItemReplace("DWDUST",".+",Player.)[%newline%]*END~
			COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
			PATCH_PRINT ~Patching: %num_matches% matches wiped out from %SOURCE_FILESPEC%~
			PATCH_IF (num_matches < 84) BEGIN
				SET skip_DROWIT = 1
				SPRINT log ~%log%Skipping Drow items tweak, some other mod already changed the default implementation (Could not find %textToReplace% in %SOURCE_FILESPEC% at least 84 times).%LNL%~
			END ELSE BEGIN
				REPLACE_EVALUATE CASE_INSENSITIVE ~%textToReplace%~ BEGIN
					INNER_ACTION BEGIN
						EXTEND_TOP ~K#DROWIT.BCS~ ~.../K#DROWIT-et.baf~ EVALUATE_BUFFER
					END
				END ~~
			END
		END
	END
BUT_ONLY

ACTION_IF (skip_HolySymbols = 0) BEGIN
	COPY_EXISTING ~CDHLYSYM.SPL~ ~override~
		LPF ADD_SPELL_EFFECT INT_VAR opcode = 177 /*Use EFF File*/ target = 1 power = 4 parameter1 = 0 parameter2 = 2 timing = 1 resist_dispel = 2 STR_VAR resource = "K#HLYSYM" END
	BUT_ONLY
	COPY ~EET_Tweaks/base/junk/K#HLYSYM.CRE~ ~override~
		~EET_Tweaks/base/junk/K#HLYSYM.EFF~ ~override~
	COMPILE ~EET_Tweaks/base/junk/K#HLYSYM.baf~
END

ACTION_IF (skip_Lilarcor = 0) BEGIN
	COPY_EXISTING ~SW2H14.ITM~ ~override~
		LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 272 /*Use EFF file on condition*/ target = 1 parameter1 = 6 parameter2 = 3 timing = 2 STR_VAR resource = "K#LILARC" END
	BUT_ONLY
	COPY ~EET_Tweaks/base/junk/K#LILARC.CRE~ ~override~
		~EET_Tweaks/base/junk/K#LILARC.EFF~ ~override~
	COMPILE ~EET_Tweaks/base/junk/K#LILARC.baf~
END

ACTION_IF (skip_Harpell = 0) AND (NOT FILE_EXISTS_IN_GAME ~cdt03160.g3~) BEGIN //BG2 Tweaks "Keep Drizzt's Loot, Disable Malchor Harpell" component not detected
	EXTEND_BOTTOM ~AR0800.BCS~ ~EET_Tweaks/base/junk/Harpell.baf~
END

ACTION_IF (skip_DROWIT = 0) BEGIN
	COPY_EXISTING_REGEXP GLOB ~^.+\.BCS$~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			REPLACE_EVALUATE CASE_INSENSITIVE ~SetGlobal("oh_drow_items_safe","GLOBAL",0)~ BEGIN
				PATCH_PRINT ~Drow items invisible creature spawning added to %SOURCE_FILESPEC%~
			END ~SetGlobal("oh_drow_items_safe","GLOBAL",0)
		CreateCreatureObject("K#DROWIT",Player1,0,0,0)~
		END
	BUT_ONLY
	COPY ~EET_Tweaks/base/junk/K#DROWIT.CRE~ ~override~
		~EET_Tweaks/base/junk/K#DROWIT.EFF~ ~override~
		~EET_Tweaks/base/junk/K#DROWIT.SPL~ ~override~
	COMPILE ~EET_Tweaks/base/junk/K#DROWIT.baf~
END

//Leftover BG:EE ARE scripts code
ACTION_FOR_EACH file IN AR0100 AR0101 AR0103 AR0106 AR0108 AR0111 AR0112 AR0114 AR0115 AR0119 AR0121 AR0123 AR0125 AR0128 AR0130 AR0137 AR0138 AR0145 AR0146 AR0149 AR0153 AR0608 AR0612 AR1803 AR2301 AR2609 AR2611 AR2626 AR3300 AR3304 AR3352 AR5400 AR5405 BEGIN
	ACTION_IF NOT FILE_EXISTS_IN_GAME ~%file%.ARE~ BEGIN //just to be sure that other mod didn't add these areas
		COPY - ~.../blank.txt~ ~.../%file%.baf~
		COMPILE ~.../%file%.baf~
	END
END

//Leftover BG:EE ARE scripts code used in scripts that are also used in BG2:EE
ACTION_FOR_EACH file IN AR0514 AR2001 BEGIN
	COPY_EXISTING ~%file%.BCS~ ~override~
		REPLACE_BCS_BLOCK ~EET_Tweaks/base/junk/%file%.baf~ ~.../blank.baf~ ON_MISMATCH SPRINT log ~%log%Skipping %file%.BCS cleaning, some other mod already changed the default implementation.%LNL%~ END
	BUT_ONLY
END

PRINT ~%log%~

/////                                                  \\\\\
///// Import party items to SoA                        \\\\\
/////                                                  \\\\\

BEGIN @930500 /*Import party items to SoA*/
DESIGNATED 4040
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

COPY_EXISTING ~AR0602.BCS~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~ActionOverride("K#ImportContainer"~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~ActionOverride("Table2"~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
		SPRINT textToReplace ~"AR0602\*K#ImportContainer"~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~"AR0602*Table2"~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
		END ELSE BEGIN
			PATCH_WARN ~WARNING: could not find %textToReplace% in %SOURCE_FILESPEC%~
		END
	END
BUT_ONLY

/////                                                  \\\\\
///// Books/Scrolls categorization                     \\\\\
/////                                                  \\\\\

BEGIN @930600 /*Books/Scrolls categorization*/
DESIGNATED 4050
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~bgee bg2ee eet~ @990000 /*This component is not compatible with your game*/

LOAD_TRA ~EET_Tweaks/lang/%LANGUAGE%/categorization.tra~

//Durlag's Tower 'Dusty Book' tweak
ACTION_FOR_EACH file IN BOOK71 BOOK72 BOOK73 BOOK74 BOOK75 BOOK76 BOOK77 BOOK78 BOOK79 BOOK80 BOOK81 BOOK82 BOOK83 BOOK84 BOOK85 BOOK86 BEGIN
	COPY_EXISTING ~%file%.itm~ ~override~
		SAY NAME1 @0 /*Dusty Page*/
		SAY NAME2 @0 /*Dusty Page*/
		WRITE_SHORT 0x1c 11 //Scrolls
		WRITE_ASCII 0x3a ~IMISC8C~
		WRITE_ASCII 0x44 ~GSCRL01~
		WRITE_LONG 0x34 0
		WRITE_LONG 0x4c 0
		WRITE_ASCII 0x58 ~CMISC8C~
	BUT_ONLY
END

//Fixes for incorrectly assigned ground icons
ACTION_FOR_EACH file IN misc7e /*Fairy Dust*/ plot02h /*Deck of Cards*/ BEGIN
	ACTION_IF FILE_EXISTS_IN_GAME ~%file%.itm~ BEGIN
		COPY_EXISTING ~%file%.itm~ ~override~ //
			READ_ASCII 0x44 groundIcon
			PATCH_IF (~%groundIcon%~ STR_EQ ~GBOOK01~) BEGIN
				WRITE_ASCII 0x44 ~GSACK01~ //fix wrong ground icon assigned
			END
		BUT_ONLY
	END
END
ACTION_IF FILE_EXISTS_IN_GAME ~miscb2.itm~ BEGIN
	COPY_EXISTING ~miscb2.itm~ ~override~ //Golden Goblet of Life
		READ_ASCII 0x44 groundIcon
		PATCH_IF (~%groundIcon%~ STR_EQ ~GSCRL01~) BEGIN
			WRITE_ASCII 0x44 ~GPOTN01~ //fix wrong ground icon assigned
		END
	BUT_ONLY
END

//Books/Scrolls categorization
COPY_EXISTING_REGEXP GLOB ~^.+\.itm$~ ~override~
	READ_ASCII 0x44 groundIcon
	READ_SHORT 0x1c category
	PATCH_IF (~%groundIcon%~ STR_EQ ~GBOOK01~) BEGIN //Book ground icon
		READ_SHORT 0x68 abilities_num
		READ_SHORT 0x70 effects_num
		PATCH_IF ((category = 0 /*Miscellaneous*/) OR (category = 11 /*Scrolls*/)) AND (abilities_num = 0) AND (effects_num = 0) AND (NOT FILE_CONTAINS_EVALUATED (~ITEMDIAL.2DA~ ~^[ %TAB%]*%SOURCE_RES%[ %TAB%]~)) AND (NOT FILE_CONTAINS_EVALUATED (~ITEMSPEC.2DA~ ~^[ %TAB%]*%SOURCE_RES%[ %TAB%]~)) BEGIN
			WRITE_SHORT 0x1c 37 //Books
			PATCH_IF category = 0 BEGIN
				SPRINT type ~Miscellaneous~
			END ELSE BEGIN
				SPRINT type ~Scroll~
			END
			PATCH_PRINT ~Patching %SOURCE_FILE% category: %category% (%type%) => 37 (Book)~
		END
	END ELSE PATCH_IF (~%groundIcon%~ STR_EQ ~GSCRL01~) BEGIN //Scroll ground icon
		PATCH_IF ((category = 0 /*Miscellaneous*/) OR (category = 37 /*Books*/)) AND (NOT FILE_CONTAINS_EVALUATED (~ITEMDIAL.2DA~ ~^[ %TAB%]*%SOURCE_RES%[ %TAB%]~)) AND (NOT FILE_CONTAINS_EVALUATED (~ITEMSPEC.2DA~ ~^[ %TAB%]*%SOURCE_RES%[ %TAB%]~)) BEGIN
			WRITE_SHORT 0x1c 11 //Scrolls
			PATCH_IF category = 0 BEGIN
				SPRINT type ~Miscellaneous~
			END ELSE BEGIN
				SPRINT type ~Book~
			END
			PATCH_PRINT ~Patching %SOURCE_FILE% category: %category% (%type%) => 11 (Scroll)~
		END
	END
BUT_ONLY

/////                                                  \\\\\
///// Wand Case                                        \\\\\
/////                                                  \\\\\

BEGIN @930700 /*Wand Case*/
DESIGNATED 4060
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~soa tob tutu tutu_totsc bgt bgee bg2ee eet~ @990000 /*This component is not compatible with your game*/
FORBID_COMPONENT ~WandCase/WandCase.tp2~ 0 @990002 /*Similar tweak already installed*/

LOAD_TRA ~EET_Tweaks/lang/%LANGUAGE%/wandcase.tra~

COPY ~EET_Tweaks/base/wandcase/K#WANDCA.bam~ ~override~
COPY ~EET_Tweaks/base/wandcase/K#WANDCA.itm~ ~override/K#WAND01.itm~
	~EET_Tweaks/base/wandcase/K#WANDCA.itm~ ~override/K#WAND02.itm~
	~EET_Tweaks/base/wandcase/K#WANDCA.itm~ ~override/K#WAND03.itm~
	SAY NAME1 @0
	SAY NAME2 @0
	SAY IDENTIFIED_DESC @1
	SAY UNIDENTIFIED_DESC @1
COPY ~EET_Tweaks/base/wandcase/K#WANDCA.sto~ ~override/K#WAND01.sto~
	~EET_Tweaks/base/wandcase/K#WANDCA.sto~ ~override/K#WAND02.sto~
	~EET_Tweaks/base/wandcase/K#WANDCA.sto~ ~override/K#WAND03.sto~
	SAY STORE_NAME @0

// BG1 stores
ACTION_IF GAME_IS ~bgee bgt eet~ BEGIN
	COPY_EXISTING ~highhedg.sto~ ~override~
		ADD_STORE_ITEM ~K#WAND01~ AFTER ~BAG06~ #0 #0 #0 ~IDENTIFIED~ #1
	BUT_ONLY
END ELSE ACTION_IF GAME_IS ~tutu tutu_totsc~ BEGIN
	COPY_EXISTING ~_ighhegd.sto~ ~override~
		ADD_STORE_ITEM ~K#WAND01~ #0 #0 #0 ~IDENTIFIED~ #1
	BUT_ONLY
END

// BG2 stores
ACTION_IF GAME_IS ~tob bg2ee bgt eet~ BEGIN
	COPY_EXISTING ~ribald.sto~ ~override~
		ADD_STORE_ITEM ~K#WAND02~ AFTER ~BAG02~ #0 #0 #0 ~IDENTIFIED~ #1
	BUT_ONLY
	COPY_EXISTING ~sarbar01.sto~ ~override~
		ADD_STORE_ITEM ~K#WAND03~ AFTER ~BOOT01~ #0 #0 #0 ~IDENTIFIED~ #1
	BUT_ONLY
END ELSE ACTION_IF GAME_IS ~soa~ BEGIN
	COPY_EXISTING ~ribald.sto~ ~override~
		ADD_STORE_ITEM ~K#WAND02~ #0 #0 #0 ~IDENTIFIED~ #1
	BUT_ONLY
END

/////                                                  \\\\\
///// Key Ring                                         \\\\\
/////                                                  \\\\\

BEGIN @930800 /*Key Ring*/
DESIGNATED 4070
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

COPY_EXISTING ~bdkeyr.itm~ ~override/K#KEYR01.itm~
	~bdkeyr.itm~ ~override/K#KEYR02.itm~
	~bdkeyr.itm~ ~override/K#KEYR03.itm~
COPY_EXISTING ~bdkeyr.sto~ ~override/K#KEYR01.sto~
	~bdkeyr.sto~ ~override/K#KEYR02.sto~
	~bdkeyr.sto~ ~override/K#KEYR03.sto~

// BG1 stores
COPY_EXISTING ~highhedg.sto~ ~override~
	ADD_STORE_ITEM ~K#KEYR01~ AFTER ~BAG06~ #0 #0 #0 ~IDENTIFIED~ #1
BUT_ONLY

// BG2 stores
COPY_EXISTING ~ribald.sto~ ~override~
	ADD_STORE_ITEM ~K#KEYR02~ AFTER ~BAG02~ #0 #0 #0 ~IDENTIFIED~ #1
BUT_ONLY
COPY_EXISTING ~sarbar01.sto~ ~override~
	ADD_STORE_ITEM ~K#KEYR03~ AFTER ~BOOT01~ #0 #0 #0 ~IDENTIFIED~ #1
BUT_ONLY

/////                                                  \\\\\
///// Replace classic BG1 movies with BG:EE ones       \\\\\
/////                                                  \\\\\

BEGIN @930901 /*Replace movies*/
DESIGNATED 4080
SUBCOMPONENT @930900 /*Replace classic BG1 movies with BG:EE ones*/
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

COPY - ~weidu.conf~ ~weidu.conf~
	READ_2DA_ENTRY 0 2 3 "tlk_dir"

MKDIR ~lang/%tlk_dir%/movies~
COPY_LARGE ~EET/EE_movies~ ~lang/%tlk_dir%/movies~

COPY_EXISTING ~bgee.lua~ ~override~
	REPLACE_TEXTUALLY ~'intro_', 1, 120,~ ~'intro_', 1, 120,~
	REPLACE_TEXTUALLY ~'intro_', 569, 629,~ ~'intro_', 719, 779,~
	REPLACE_TEXTUALLY ~'intro_', 618, 668,~ ~'intro_', 809, 869,~
	REPLACE_TEXTUALLY ~'intro_', 669, 741,~ ~'intro_', 889, 959,~
	REPLACE_TEXTUALLY ~'intro_', 760, 820,~ ~'intro_', 949, 989,~
BUT_ONLY

BEGIN @930902 /*Also disable BG1 movies that don't have BG:EE variants*/
DESIGNATED 4081
SUBCOMPONENT @930900 /*Replace classic BG1 movies with BG:EE ones*/
GROUP @930000 /*Miscellaneous*/
REQUIRE_PREDICATE GAME_IS ~eet~ @990000 /*This component is not compatible with your game*/

COPY - ~weidu.conf~ ~weidu.conf~
	READ_2DA_ENTRY 0 2 3 "tlk_dir"

MKDIR ~lang/%tlk_dir%/movies~
COPY_LARGE ~EET/EE_movies~ ~lang/%tlk_dir%/movies~

COPY_EXISTING ~bgee.lua~ ~override~
	REPLACE_TEXTUALLY ~'intro_', 1, 120,~ ~'intro_', 1, 120,~
	REPLACE_TEXTUALLY ~'intro_', 569, 629,~ ~'intro_', 719, 779,~
	REPLACE_TEXTUALLY ~'intro_', 618, 668,~ ~'intro_', 809, 869,~
	REPLACE_TEXTUALLY ~'intro_', 669, 741,~ ~'intro_', 889, 959,~
	REPLACE_TEXTUALLY ~'intro_', 760, 820,~ ~'intro_', 949, 989,~
BUT_ONLY

ACTION_DEFINE_ASSOCIATIVE_ARRAY file_movie BEGIN
	BG3300 => BEREGOST
	BG0125 => BHAAL
	BG2608 => CNDLKEEP
	BG0111 => DUNGEON
	BG0500 => DURLAG
	BG5100 => GNOLL
	BG0616 => IRONTHRN
	BG0108 => PALACE
	BG0224 => SEWER
	BG0225 => SEWER
	BG0226 => SEWER
	BG0705 => TAVERN
	BG1700 => WYVERN
END

ACTION_PHP_EACH file_movie AS file => movie BEGIN
	COPY_EXISTING ~%file%.BCS~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			REPLACE_TEXTUALLY ~StartMovie("%movie%")~ ~~
		END
	BUT_ONLY
END

COPY_EXISTING_REGEXP GLOB ~.+\.ARE~ ~override~
	READ_BYTE 0x48 flags
	PATCH_IF (flags BAND BIT0) AND (flags BAND BIT1) AND (flags BAND BIT3) AND (flags BAND BIT6) BEGIN
		READ_ASCII 0x94 script
		PATCH_IF FILE_EXISTS_IN_GAME ~%script%.BCS~ BEGIN
			INNER_ACTION BEGIN
				COPY_EXISTING ~%script%.BCS~ ~override~
					DECOMPILE_AND_PATCH BEGIN
						REPLACE_TEXTUALLY ~StartMovie("BGSUNRIS")~ ~~
						REPLACE_TEXTUALLY ~StartMovie("BGSUNSET")~ ~~
					END
				BUT_ONLY
			END
		END
	END
BUT_ONLY
